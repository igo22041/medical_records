# Система управления медицинскими записями

Веб-приложение для управления медицинскими записями с поддержкой двух ролей: пользователь и администратор.

## Функциональность

### Для пользователей:
- Регистрация и авторизация
- Добавление медицинских записей с указанием статуса болезни
- Просмотр своих записей
- Поиск записей по различным критериям
- Фильтрация записей по статусу (активная, на лечении, выздоровел, хроническая, отменена)
- Редактирование своих записей
- Удаление своих записей

### Для администраторов:
- Все функции пользователя
- Просмотр всех записей в системе
- Управление записями всех пользователей (редактирование, удаление)
- Поиск и фильтрация по всем записям
- **Расширенная статистика:**
  - Распределение записей по статусам с визуализацией
  - Статистика активности пользователей
  - Распределение пациентов по возрастным группам
  - Последние добавленные записи

## Технологии

- PHP 7.4+
- MySQL
- PDO для работы с базой данных
- Чистый CSS для стилизации
- Сессии для аутентификации

## Установка

1. Убедитесь, что у вас установлены:
   - PHP 7.4 или выше
   - MySQL 5.7 или выше
   - Веб-сервер (Apache/Nginx) или встроенный PHP сервер

2. Клонируйте или скопируйте проект в директорию веб-сервера

3. Создайте базу данных:
   ```sql
   mysql -u root -p < database/init.sql
   ```
   Или импортируйте файл `database/init.sql` через phpMyAdmin
   
   **Если база данных уже существует**, выполните миграцию для добавления поля статуса:
   ```sql
   mysql -u root -p medical_records < database/migration_add_status.sql
   ```

4. Настройте подключение к базе данных:
   
   **Для локальной разработки:**
   - Создайте файл `.env` на основе `.env.example`
   - Или отредактируйте `config/database.php` напрямую
   
   **Для Railway (production):**
   - Переменные окружения настраиваются автоматически
   - См. подробности в `RAILWAY.md`

5. Установите зависимости:
   ```bash
   composer install
   ```

6. Запустите веб-сервер:
   ```bash
   php -S localhost:8000
   ```

7. Откройте браузер и перейдите по адресу `http://localhost:8000`

## Тестовые учетные данные

### Администратор:
- Имя пользователя: `admin`
- Пароль: `admin123`

### Пользователь:
- Имя пользователя: `user`
- Пароль: `user123`

## Деплой на Railway

Проект готов к деплою на Railway. Подробные инструкции см. в файле [RAILWAY.md](RAILWAY.md).

**Быстрый старт:**
1. Подключите репозиторий к Railway
2. Добавьте MySQL базу данных
3. Выполните SQL скрипты из `database/init.sql`
4. Railway автоматически задеплоит приложение

## Структура проекта

```
kursovoi/
├── admin/
│   └── dashboard.php          # Панель администратора
├── assets/
│   └── css/
│       └── style.css          # Стили приложения
├── config/
│   ├── database.php           # Подключение к БД (использует переменные окружения)
│   ├── env.php                # Загрузка переменных окружения
│   ├── session.php            # Управление сессиями
│   └── statuses.php           # Конфигурация статусов записей
├── database/
│   ├── init.sql               # SQL скрипт инициализации БД
│   └── migration_add_status.sql # Миграция для добавления статуса
├── includes/
│   ├── header.php             # Шапка сайта
│   └── footer.php             # Подвал сайта
├── models/
│   ├── User.php               # Модель пользователя
│   └── MedicalRecord.php      # Модель медицинской записи
├── .env.example               # Пример переменных окружения
├── railway.json               # Конфигурация Railway
├── nixpacks.toml              # Конфигурация сборки для Railway
├── RAILWAY.md                 # Документация по деплою на Railway
├── add_record.php             # Добавление записи
├── delete_record.php          # Удаление записи
├── edit_record.php            # Редактирование записи
├── index.php                  # Главная страница
├── login.php                  # Страница входа
├── logout.php                 # Выход из системы
├── records.php                # Список записей
├── register.php               # Регистрация
├── view_record.php            # Просмотр записи
└── README.md                  # Документация
```

## Безопасность

- Пароли хешируются с помощью `password_hash()`
- Используется подготовленные запросы (prepared statements) для защиты от SQL-инъекций
- Данные пользователя экранируются с помощью `htmlspecialchars()`
- Проверка прав доступа на уровне сессий
- Валидация входных данных

## Лицензия

Этот проект создан в образовательных целях для курсовой работы.

